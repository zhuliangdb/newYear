# 脸谱架构

本文档详细描述了豫剧脸谱DIY功能的架构设计和实现方案。

## 功能概述

豫剧脸谱DIY功能允许用户创建和自定义属于自己的豫剧脸谱，体验传统戏曲文化的魅力。用户可以选择不同的脸型、颜色和图案，生成个性化的脸谱效果。

## 技术架构

### 1. 前端架构

#### 组件结构

```
src/
├── components/
│   └── new-year/
│       └── FacialMakeupComponent.vue  # 脸谱DIY组件
├── stores/
│   └── facialMakeup.js  # 脸谱状态管理
├── utils/
│   └── facialMakeupUtils.js  # 脸谱工具函数
└── views/
    └── CulturalFeatures.vue  # 文化特色页面（包含脸谱DIY功能）
```

#### 核心模块

1. **脸谱组件**：负责用户界面和交互
2. **状态管理**：管理脸谱的状态和配置
3. **工具函数**：提供脸谱生成和处理的核心逻辑
4. **数据存储**：保存用户创建的脸谱

### 2. 数据流

```
用户交互 → 组件状态更新 → 状态管理 → 脸谱生成 → 预览显示 → 保存分享
```

## 功能模块

### 1. 脸型选择

#### 功能描述
- 提供多种预设脸型供用户选择
- 支持自定义脸型参数

#### 技术实现
- 使用SVG或Canvas绘制不同脸型
- 实现脸型参数的实时调整

### 2. 颜色选择

#### 功能描述
- 提供多种传统脸谱颜色
- 支持颜色的自定义调配

#### 技术实现
- 使用颜色选择器组件
- 实现颜色的实时预览

### 3. 图案选择

#### 功能描述
- 提供多种传统脸谱图案
- 支持图案的组合和自定义

#### 技术实现
- 使用SVG或Canvas绘制图案
- 实现图案的叠加和混合

### 4. 脸谱生成

#### 功能描述
- 根据用户选择生成完整的脸谱
- 支持实时预览

#### 技术实现
- 使用Canvas或SVG合成技术
- 实现脸谱的实时渲染

### 5. 保存和分享

#### 功能描述
- 支持保存用户创建的脸谱
- 支持分享脸谱到社交媒体

#### 技术实现
- 使用Firebase存储用户创建的脸谱
- 实现分享链接的生成

## 技术实现

### 1. 前端技术

#### 核心技术
- Vue 3：前端框架
- Canvas/SVG：脸谱绘制
- Pinia：状态管理
- Firebase：数据存储

#### 第三方库
- fabric.js：Canvas操作库（可选）
- html2canvas：HTML转Canvas（用于保存功能）

### 2. 后端技术

- Firebase Storage：存储用户创建的脸谱
- Firebase Firestore：存储脸谱配置数据

## 实现步骤

### 1. 基础架构搭建

1. 创建脸谱DIY组件
2. 配置状态管理
3. 实现基础UI界面

### 2. 核心功能实现

1. 实现脸型选择功能
2. 实现颜色选择功能
3. 实现图案选择功能
4. 实现脸谱生成逻辑

### 3. 高级功能实现

1. 实现脸谱保存功能
2. 实现脸谱分享功能
3. 优化用户界面和交互

### 4. 测试和优化

1. 功能测试
2. 性能优化
3. 用户体验优化

## 数据结构

### 1. 脸谱配置

```javascript
{
  id: "unique-id",
  name: "脸谱名称",
  faceShape: "round", // 脸型：round, square, oval
  baseColor: "#e63946", // 基础颜色
  patterns: [ // 图案列表
    {
      id: "pattern-1",
      type: "lightning", // 图案类型
      color: "#ffd700", // 图案颜色
      position: { x: 0, y: 0 }, // 图案位置
      scale: 1, // 图案缩放
      rotation: 0 // 图案旋转
    }
  ],
  createdAt: "2026-01-25T00:00:00Z", // 创建时间
  updatedAt: "2026-01-25T00:00:00Z" // 更新时间
}
```

### 2. 预设数据

#### 预设脸型

```javascript
const faceShapes = [
  { id: "round", name: "圆形脸", svg: "path-to-svg" },
  { id: "square", name: "方形脸", svg: "path-to-svg" },
  { id: "oval", name: "瓜子脸", svg: "path-to-svg" }
];
```

#### 预设颜色

```javascript
const colors = [
  { id: "red", name: "红色", value: "#e63946" },
  { id: "blue", name: "蓝色", value: "#1d3557" },
  { id: "green", name: "绿色", value: "#2a9d8f" },
  { id: "yellow", name: "黄色", value: "#ffd700" },
  { id: "black", name: "黑色", value: "#2b2d42" }
];
```

#### 预设图案

```javascript
const patterns = [
  { id: "lightning", name: "闪电纹", svg: "path-to-svg" },
  { id: "flame", name: "火焰纹", svg: "path-to-svg" },
  { id: "wave", name: "波浪纹", svg: "path-to-svg" },
  { id: "flower", name: "花卉纹", svg: "path-to-svg" }
];
```

## 性能优化

### 1. 渲染优化

- 使用Canvas而非DOM元素进行绘制，提高性能
- 实现渲染缓存，避免重复计算
- 使用requestAnimationFrame进行动画渲染

### 2. 资源优化

- 压缩SVG资源
- 实现资源的懒加载
- 优化图像大小和质量

### 3. 交互优化

- 实现防抖和节流，优化用户输入
- 提供预加载和进度指示
- 优化触摸设备的交互体验

## 兼容性考虑

### 1. 浏览器兼容性

- 支持主流现代浏览器
- 提供降级方案，确保在旧浏览器中也能基本使用

### 2. 设备兼容性

- 适配桌面端和移动端
- 优化触摸设备的交互体验
- 确保在不同屏幕尺寸下的显示效果

## 未来扩展

### 1. 功能扩展

- 支持更多脸谱类型（京剧、川剧等）
- 实现脸谱动画效果
- 添加AR功能，实时预览脸谱效果

### 2. 技术扩展

- 集成AI技术，自动生成个性化脸谱
- 实现3D脸谱效果
- 支持更多导出格式

## 结论

豫剧脸谱DIY功能的架构设计充分考虑了用户体验、性能和可扩展性，通过现代化的前端技术实现传统戏曲文化的数字化体验。该架构不仅满足了当前功能需求，也为未来的功能扩展和技术升级预留了空间。