# 项目模式库

本文件记录了项目中使用的各种设计模式、最佳实践和架构原则，旨在为团队提供统一的开发标准和参考。

## 1. 组件模式

### 1.1 复合组件模式

**用途**：用于构建灵活、可组合的组件，如导航栏和弹窗。

**实现示例**：
- `Navbar.vue` - 使用插槽实现灵活的导航栏结构
- `Popup.vue` - 使用插槽实现可定制的弹窗内容

**核心特点**：
- 使用 `slot` 和具名插槽实现内容的灵活注入
- 提供默认内容，同时支持完全自定义
- 暴露组件方法供父组件调用（如 `closeMobileMenu`）

### 1.2 异步组件模式

**用途**：用于懒加载大型组件，提升页面加载速度。

**实现示例**：
- `AsyncSnowfall.vue` - 懒加载雪花动画组件

**核心特点**：
- 使用 `defineAsyncComponent` 实现组件的异步加载
- 适用于仅在特定条件下显示的组件

### 1.3 响应式组件模式

**用途**：确保组件在不同设备上都能正常显示。

**实现示例**：
- `Navbar.vue` - 适配桌面端和移动端的导航栏
- `Popup.vue` - 响应式弹窗布局

**核心特点**：
- 使用媒体查询适配不同屏幕尺寸
- 为移动端和桌面端提供不同的交互方式

## 2. 状态管理模式

### 2.1 Pinia 状态管理

**用途**：集中管理应用状态，如用户消息和愿望。

**实现示例**：
- `wishes.ts` - 管理用户愿望数据
- `messages.ts` - 管理用户消息数据

**核心特点**：
- 使用 `defineStore` 定义状态管理模块
- 实现异步操作（如加载数据）
- 添加输入验证逻辑
- 支持状态持久化

### 2.2 输入验证模式

**用途**：确保用户输入数据的合法性。

**实现示例**：
- `wishes.ts` - 验证愿望长度
- `messages.ts` - 验证作者名称和消息长度

**核心特点**：
- 在状态管理中集成验证逻辑
- 提供清晰的错误信息
- 防止无效数据的提交

## 3. 动画模式

### 3.1 CSS 动画模式

**用途**：实现流畅的用户界面动画。

**实现示例**：
- `variables.css` - 定义动画变量和关键帧
- `NewYearSurprise.vue` - 使用动画实现灯笼摇摆和浮动效果

**核心特点**：
- 使用 CSS 变量统一管理动画参数
- 定义可复用的动画关键帧
- 实现微交互动画提升用户体验

### 3.2 粒子动画模式

**用途**：实现雪花等粒子效果。

**实现示例**：
- `Snowfall.vue` - 使用 jparticles 实现雪花动画

**核心特点**：
- 适配移动设备（在移动设备上减少粒子数量）
- 预加载图片资源
- 优化性能，避免过度消耗资源

## 4. 安全模式

### 4.1 CSRF 保护模式

**用途**：防止跨站请求伪造攻击。

**实现示例**：
- `csrf.ts` - 生成和验证 CSRF 令牌

**核心特点**：
- 生成唯一的 CSRF 令牌
- 存储令牌到 localStorage
- 在请求中包含令牌进行验证

### 4.2 环境变量管理

**用途**：安全管理敏感配置信息。

**实现示例**：
- `firebase.ts` - 使用环境变量存储 Firebase 配置
- `.env.example` - 提供环境变量模板
- `.gitignore` - 排除 .env 文件

**核心特点**：
- 使用 `import.meta.env` 读取环境变量
- 提供默认值作为备选
- 避免将敏感信息提交到版本控制

## 5. 测试模式

### 5.1 单元测试模式

**用途**：确保组件和状态管理的正确性。

**实现示例**：
- `Navbar.test.ts` - 测试导航栏组件
- `Popup.test.ts` - 测试弹窗组件
- `wishes.test.ts` - 测试愿望状态管理
- `messages.test.ts` - 测试消息状态管理

**核心特点**：
- 使用 Vitest 和 @vue/test-utils 进行测试
- 测试组件的渲染和交互
- 测试状态管理的逻辑和验证
- 使用 async/await 和 nextTick() 处理异步操作

### 5.2 测试覆盖策略

**用途**：确保代码的关键部分都有测试覆盖。

**实现示例**：
- `vitest.config.ts` - 配置测试覆盖报告

**核心特点**：
- 设定测试覆盖目标（80%）
- 排除不需要测试的文件（如 main.ts）
- 生成详细的测试覆盖报告

## 6. 性能优化模式

### 6.1 代码分割模式

**用途**：减少初始加载时间，提升用户体验。

**实现示例**：
- `AsyncSnowfall.vue` - 懒加载雪花组件

**核心特点**：
- 使用 `defineAsyncComponent` 实现组件的按需加载
- 适用于非关键路径的组件

### 6.2 资源优化模式

**用途**：优化图片和其他资源的加载。

**实现示例**：
- `Snowfall.vue` - 预加载雪花图片

**核心特点**：
- 预加载关键资源
- 适配不同设备的资源需求

## 7. 架构原则

### 7.1 单一职责原则

**用途**：确保每个组件和模块只负责一个功能。

**实现示例**：
- 组件专注于 UI 渲染
- 状态管理专注于数据逻辑
- 工具函数专注于特定功能

### 7.2 依赖注入原则

**用途**：通过依赖注入提高代码的可测试性和可维护性。

**实现示例**：
- 使用 Pinia 进行状态管理
- 使用 Vue 的 provide/inject API（如需要）

### 7.3 可测试性原则

**用途**：确保代码易于测试，提高代码质量。

**实现示例**：
- 组件设计考虑测试场景
- 状态管理逻辑可独立测试
- 使用模拟数据进行测试

## 8. 最佳实践

### 8.1 代码风格

- 使用 ESLint 和 Prettier 统一代码风格
- 遵循 Vue 3 Composition API 的最佳实践
- 使用 TypeScript 提供类型安全

### 8.2 命名规范

- 组件名使用 PascalCase
- 文件和目录名使用 kebab-case
- 变量和函数名使用 camelCase
- 常量使用 UPPER_SNAKE_CASE

### 8.3 注释规范

- 使用 JSDoc 注释函数和类型
- 为复杂逻辑添加内联注释
- 为组件添加功能描述

### 8.4 版本控制

- 使用 .gitignore 排除不必要的文件
- 提交信息清晰明了
- 遵循语义化版本规范

## 9. 扩展指南

### 9.1 添加新组件

1. 遵循复合组件模式（如适用）
2. 添加 TypeScript 类型定义
3. 实现响应式设计
4. 添加单元测试
5. 记录到模式库

### 9.2 添加新状态管理模块

1. 使用 Pinia 的 defineStore
2. 集成输入验证
3. 添加异步操作支持
4. 添加单元测试
5. 记录到模式库

### 9.3 添加新动画

1. 使用 CSS 变量和关键帧
2. 考虑性能影响
3. 适配移动设备
4. 记录到模式库

## 10. 参考资源

- [Vue 3 官方文档](https://v3.vuejs.org/)
- [Pinia 官方文档](https://pinia.vuejs.org/)
- [Vitest 官方文档](https://vitest.dev/)
- [ESLint 官方文档](https://eslint.org/)
- [Prettier 官方文档](https://prettier.io/)

---

本模式库将随着项目的发展不断更新和完善，欢迎团队成员提出建议和贡献。